---
title: 단타 전략
parent: 투자
nav_order: 4
---

# 단타 전략
{:.no_toc}

## 목차
{:.no_toc}

1. TOC
{:toc}

---

## 초단타, 단타, 스윙

### 암호화폐 기준 포지션 운용 요약

| 구분 | 차트 주기 | 평균 포지션 유지 시간 | 특징 |
|------|------------|------------------------|------|
| 초단타 (Scalping) | 15초봉 ~ 1분봉 | 5분 ~ 30분 | 극단적 변동성 대응, 빠른 진입/청산, 높은 수수료 고려 필요 |
| 단타 (Day Trading) | 3분봉 ~ 15분봉 | 1시간 ~ 6시간 | 단기 추세 추종, 데이 트레이딩 중심 |
| 스윙 (Swing Trading) | 1시간봉 ~ 4시간봉 | 12시간 ~ 3일 | 중기 추세 중심, 손익폭이 크지만 리스크 관리 중요 |

### 참고사항
- 타임프레임이 짧을수록 변동성이 커지고, 포지션 정리 주기도 짧아집니다.
- 초단타에서는 거래 수수료 및 슬리피지가 실질 수익률에 큰 영향을 미칩니다.
- 단타 이상에서는 1시간봉 또는 4시간봉의 추세 방향성과 일치하는 진입만 선별하는 것이 유효합니다.

---

## 데이트레이딩 (15분봉 / 1시간봉 기준)

### 타임프레임 구성

- 캔들 8 ~ 24개 사이에서 포지션을 정리하는 것이 이상적이라고 함.
- ex. 15분봉 x (8 ~ 24) >> 2 ~ 6시간


| 구분 | 차트 주기 | 역할 |
|------|------------|------|
| 메인 프레임 | 15분봉 | 진입/청산 트리거 |
| 상위 프레임 | 1시간봉 | 추세 방향성 확인 |
| 보조 프레임 | 4시간봉 | 주요 지지/저항대 확인 |

### 기술적 지표 조합

| 목적 | 지표 | 설정값 | 설명 |
|------|------|--------|------|
| 추세 확인 | EMA (9, 21, 50) | 기본값 | 9EMA > 21EMA → 상승 / 반대 시 하락 |
| 추세 필터 | SuperTrend | ATR 10, Multiplier 3 | 추세 반전 청산 신호로 활용 |
| 모멘텀 | MACD | (12, 26, 9) | 시그널 교차로 진입 확인 |
| 과매수/과매도 | RSI | (14) | 40~60 구간은 관망, 이탈 시 진입 타이밍 |
| 변동성 측정 | ATR | (14) | SL/TP 계산 기준 |
| 돌파 감지 | Bollinger Bands | (20, 2) | 밴드 수축 후 확장 시 진입 타이밍 |

### 포지션 유지 시간

| 차트 | 평균 유지 시간 | 전략 유형 |
|------|----------------|------------|
| 15분봉 | 2~6시간 | 단기 데이 트레이딩 |
| 1시간봉 | 6~24시간 | 짧은 스윙 트레이딩 |

### TP/SL 설정

- **손절(SL):** ATR × 1.2~1.5  
  예: ATR(14)=0.8% → SL 약 1%
- **익절(TP):** 손절폭의 2~3배  
  TP : SL = 최소 2:1 비율 유지
- **예시:** SL 1% → TP 2~3%
- **참고:** 일정 수익(+1.5%) 도달 시 절반 익절 후 트레일링 스탑 적용

### 실전 예시

| 항목 | 설정 |
|------|------|
| 차트 | 15분봉 |
| 지표 | EMA(9,21,50), SuperTrend(ATR10,3), RSI(14) |
| 레버리지 | 5~10배 |
| 진입 조건 | 1시간봉 상승, 15분봉 눌림 + RSI 40~50 + 9EMA 돌파 |
| 손절 | 진입가 - (ATR × 1.2) |
| 익절1 | 진입가 + (ATR × 2) |
| 익절2 | 진입가 + (ATR × 3) |
| 평균 홀딩 | 2~5시간 |

### 유의사항

- 15분봉 전략은 변동성이 높은 시간대(예: 뉴욕 개장 전후)에 가장 유효
- 횡보장에서는 Bollinger Band 수축 신호 주의
- 트레일링 스탑 활용으로 익절 극대화
- 레버리지는 5~8배 이하 권장 (레버리지 10배 이상에서는 “슬리피지 + 수수료”로 실질 손익률이 왜곡될 수 있음)

---

## LSTM 기반 예측 결합 마진 전략 (1시간봉 / 1일봉)

### 개요

- 목적: 1시간봉(H1)·1일봉(D1) 가격 데이터와 기술적 지표를 입력으로 **다중 시계열 LSTM 모델**을 학습하여 **1일/3일/7일** 전방 가격 변동을 예측하고, 결과를 (급등/상승/하락/급락) 4개 클래스와 연속값(수익률)로 활용해 **마진 포지션**을 운용한다.

- 핵심 아이디어: 
  1) **D1 모델(거시 방향)**로 롱/숏/관망을 결정하는 게이트, 
  2) **H1 모델(세부 타이밍)**로 진입·청산을 트리거, 
  3) **확률·기대값 기반** 포지션 크기 및 레버리지 조절.

### 데이터 및 전처리

- 샘플링: H1, D1 각각 시계열로 준비.
- 정규화: 지표별 RobustScaler(중앙값·IQR) 또는 표준화(Z-Score).
- 가격 계열: log-return(r1, r6, r24 for H1), D1 기준 r1d, r7d
- 추세/모멘텀: EMA(9,21,50), MACD(12,26,9) 라인/히스토그램, RSI(14)
- 변동성: ATR(14)
- 거래량/수급: Volume
- 시계열 맥락: 최근 N(H1=48, D1=60) 타임스텝 슬라이딩 윈도우 입력

**가격 변동 정규화 방식 비교**

| 방식 | 수식 | 특징 | 장점 | 단점 |
|------|------|------|------|------|
| **로그수익률 (Log Return)** | $r_t = \ln\left(\frac{P_t}{P_{t-1}}\right)$ | 상대적 변화율 | 정규성 높고 합산 가능 | 큰 변동 시 약간 왜곡 |
| **단순수익률 (Simple Return)** | $r_t = \frac{P_t - P_{t-1}}{P_{t-1}}$ | 퍼센트 변화율 | 직관적 | 극단치에 민감, 비정상성 |
| **차분 (Differencing)** | $r_t = P_t - P_{t-1}$ | 절대변화량 | 추세 제거, 시계열 정상화 | 가격 규모 의존적 |
| **Z-Score 정규화** | $z_t = \frac{P_t - \mu}{\sigma}$ | 표준화 | 단위 무관, 정규화 효과 높음 | 윈도우 길이에 따라 편차 |
| **Min-Max 스케일링** | $s_t = \frac{P_t - P_{min}}{P_{max} - P_{min}}$ | [0,1] 스케일 | 직관적, 신경망 입력 적합 | 이상치에 취약 |
| **로그차분 (Log Differencing)** | $\ln(P_t) - \ln(P_{t-1})$ | 로그변환 후 차분 | 로그수익률과 동일 개념 | 동일 |

### 타깃 정의(Labels)

- 회귀 타깃: $y^{(T)} = \frac{Close_{t+T} - Close_t}{Close_t}$, T ∈ {1d, 3d, 7d}
- 분류 타깃(4클래스): 임계값을 **자산의 변동성(ATR_D1) 기반**으로 동적 설정
  - 급등: $y^{(T)} \ge +k_2 \times ATR\_{D1}\%$ (기본 k2=3.0)
  - 상승: $+k_1 \times ATR\_{D1}\% \le y^{(T)} < +k_2 \times ATR\_{D1}\%$ (k1=1.0)
  - 하락: $-k_2 \times ATR\_{D1}\% < y^{(T)} \le -k_1 \times ATR\_{D1}\%$
  - 급락: $y^{(T)} \le -k_2 \times ATR\_{D1}\%$
- 대안(고정 임계값): 급등/급락 ±5%, 상승/하락 ±1~5% 구간

### 모델

- 구조: (H1용 LSTM) x 1, (D1용 LSTM) x 1 — 각자 회귀+분류 멀티헤드(공유 인코더, 회귀/분류 헤드 분기)
- 입력 길이: H1=48~96 스텝, D1=60 스텝 권장
- 손실: 회귀(MAE) + 분류(Focal CE 또는 WCE) 가중 합(α, β 튜닝) — 클래스 불균형 완화
- 검증: **워크-포워드**(rolling) + **Purged K-Fold**로 누수 방지. 엔트리/엑시트 룰까지 포함한 **리얼리즘 백테스트** 병행

### 예측 산출물

- 각 시점에 대해: 
  - D1: { p(급등), p(상승), p(하락), p(급락), $\hat{r}^{1d}$, $\hat{r}^{3d}$, $\hat{r}^{7d}$ }
  - H1: 동일한 확률 벡터와 $\hat{r}^{1d}$, $\hat{r}^{3d}$, $\hat{r}^{7d}$ (H1에선 24/72/168시간 후를 일수 환산)
- 기대수익률(예): $E[r] = \sum_{c} p_c \cdot \mu_c$, 클래스별 평균 수익률 $\mu_c$ 는 학습셋에서 추정

### 거래 규칙(게이팅 + 트리거)

- 게이팅(방향 필터, D1):
  - 롱 허용: D1에서 $p(상승)+p(급등) \ge 0.55$ 그리고 $E[r]^{3d} > 0$
  - 숏 허용: D1에서 $p(하락)+p(급락) \ge 0.55$ 그리고 $E[r]^{3d} < 0$
  - 그 외: 관망
- 트리거(H1):
  - 롱: H1에서 $p(상승)+p(급등) \ge 0.6$ **그리고** 가격이 EMA(20) 상회 재진입 또는 최근 고점 돌파
  - 숏: H1에서 $p(하락)+p(급락) \ge 0.6$ **그리고** 가격이 EMA(20) 하회 재이탈 또는 최근 저점 이탈
- 동의성 체크: D1과 H1의 방향이 **일치**해야 진입. 불일치 시 스킵

### 포지션 사이징 및 레버리지

- 계정 리스크 예산: 트레이드당 **0.5~1.0%**
- 스톱 거리: H1 ATR(14) 기반 — $SL\_{dist} = \max(1.2\times ATR\_{H1}, price\_{tick\\_min})$
- 포지션 크기: $size = \min\big( \frac{risk\_{budget}}{SL\_{dist}},\; size\_{max} \big)$
- 레버리지: $lev = \min\big( 1 + \gamma\cdot S,\; L\_{max} \big)$
  - 신뢰도 점수 $S = (p\_{bull}-p\_{bear})$ 또는 $\|E[r]\|/ATR\_{D1}$
  - 기본 $L\_{max}=5$, $\gamma=3$ 예시

### 진입·청산 규칙

- 진입: 위 트리거 충족 시 지정가 또는 VWAP±슬리피지 한도로 체결 시도
- 기본 SL/TP (초기):
  - SL: $1.2\times ATR\_{H1}$
  - TP1: $2\times ATR\_{H1}$ 도달 시 **50% 부분청산**, 잔여분은 트레일링
  - TP2: $3\times ATR\_{H1}$ 또는 D1의 $p(상승)+p(급등)$ 하락/반전 시 전량 청산
- 시간 청산(Time Stop):
  - 1일 예측 기반 포지션은 **최대 3일**, 3일 예측은 **최대 7일** 보유
  - 예측 만기가 지나면 재평가(롤오버 금지)
- 신호 무효화:
  - D1 방향 신뢰도 감소(예: $p(상승)+p(급등) < 0.45$) 시 수동 청산

### 리스크 관리 및 금지 구간

- 이벤트 회피: 변동성 급등 예상 구간(대형 경제지표, 상장/디리스팅 공지 등) N시간 전후 **신규 진입 금지**
- 연속 손실 제한: 최근 M=5 트레이드 손실 합계가 **-3%** 초과 시 그 날/그 주 **트레이딩 중단**
- 최대 포지션 수: 동일 방향 동시 보유 **2개 이하**, 상관 높은 알트 동시 진입 제한

### 백테스트/운영 체크리스트

- 데이터 분리: Train/Validation/Test를 시간순 분할. 모델 재학습 **워크-포워드**(예: 6개월 학습 → 1개월 거래) 반복
- 누수 방지: 라벨 생성 시 미래 캔들 참조 금지, 피처 생성 시 동시점 정보만 사용
- 성능 지표:
  - 분류: F1-macro, MCC, ROC-AUC(1-vs-rest), Brier Score(확률 보정)
  - 트레이딩: CAGR, Sharpe, Sortino, MaxDD, Hit-Rate, Profit Factor, Tail Risk(VaR/ES)
- 캘리브레이션: Platt/Isotonic으로 확률 보정 → 기대값 기반 사이징 안정화
- 거래 비용: 수수료·슬리피지 **시뮬레이션 포함** (레버리지 효과 반영)

### 의사코드(pseudocode)

```python
# D1 게이트
if p_d1['bull'] >= 0.55 and E_r_d1_3d > 0:
    gate = 'long'
elif p_d1['bear'] >= 0.55 and E_r_d1_3d < 0:
    gate = 'short'
else:
    gate = 'flat'

# H1 트리거 + 실행
if gate == 'long' and (p_h1['bull'] >= 0.60) and price > EMA20_h1:
    sl = price - 1.2*ATR_h1
    tp1 = price + 2.0*ATR_h1
    tp2 = price + 3.0*ATR_h1
    size = min(risk_budget/(price-sl), size_max)
    enter_long(size, sl, tp1)
    trail_remainder_to(tp2, step=0.5*ATR_h1)

if gate == 'short' and (p_h1['bear'] >= 0.60) and price < EMA20_h1:
    sl = price + 1.2*ATR_h1
    tp1 = price - 2.0*ATR_h1
    tp2 = price - 3.0*ATR_h1
    size = min(risk_budget/(sl-price), size_max)
    enter_short(size, sl, tp1)
    trail_remainder_to(tp2, step=0.5*ATR_h1)
```

### 파라미터 초기값(권장, 자산별 재튜닝)

- 확률 임계값: D1=0.55, H1=0.60
- ATR 배수: SL=1.2, TP1=2.0, TP2=3.0, 트레일링 스텝=0.5
- 레버리지 한도: Lmax=5, 트레이드당 위험 0.5~1.0%
- 클래스 경계: ATR_D1 기반 k1=1.0, k2=3.0 (또는 고정 ±1%/±5%)
