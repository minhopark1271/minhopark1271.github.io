---
nav_order: 50
parent: 프로젝트
title: '[DONE] Add volume_buy/volume_sell Features to Prediction Model'
description: "volume_buy/volume_sell 피처 추가. 매수/매도 거래량으로 시장 심리 파악. 순매수량(volume_delta) 로그 변환 및 z-score 정규화."
---

# Add volume_buy/volume_sell Features to Prediction Model
{:.no_toc}

## 목차
{:.no_toc}

1. TOC
{:toc}

---

| 상태 | 생성일 | 수정일 |
|------|--------|--------|
| completed | 2025-12-19 | 2025-12-19 |

---

## Summary

OHLCV 테이블에 존재하는 `volume_buy`/`volume_sell` 데이터를 예측 모델 피처로 활용한다. 이 데이터는 매수/매도 거래량을 나타내며, 시장 심리와 방향성 파악에 유용할 수 있다.

## Background

- 현재 예측 모델은 총 거래량(`volume`)만 사용 중
- Binance API는 `volume_buy`(매수 거래량), `volume_sell`(매도 거래량) 데이터를 제공
- 이 데이터는 이미 DB에 수집되어 있으나 모델에서 활용하지 않고 있었음

## Implementation Plan

### New Features
1. **rel_log_volume_buy**: 매수 거래량의 상대적 로그 변환
2. **rel_log_volume_sell**: 매도 거래량의 상대적 로그 변환
3. **rel_log_volume_delta**: 순매수량 (buy - sell)의 로그 변환
4. 각 피처에 대한 z-score 버전

### Processing Method
- 기존 `rel_log_volume`과 동일한 처리 방식 적용:
  - `log1p` 변환으로 스케일 정규화
  - 20-period MA 대비 상대값으로 정규화
- Volume delta는 부호 보존 로그 변환: `sign(x) * log(1 + |x|)`

---

## Implementation Results

### Changed Files
| File | Changes |
|------|---------|
| `src/prediction/prediction_model.py` | volume_buy, volume_sell 피처 처리 로직 추가 (+33 lines) |

### Details
- `_prepare_features()` 메서드에 BTC volume_buy/volume_sell 피처 처리 추가
- `base_features` 리스트에 3개 피처 추가: `rel_log_volume_buy`, `rel_log_volume_sell`, `rel_log_volume_delta`
- `z_score_features` 리스트에 해당 z-score 피처 추가
- 피처 수: 1 → 4 (거래량 관련)

### Test Results
- 기존 테스트 통과
- 모델 피처 수 정상 증가 확인

### Lessons Learned / Issues
- Volume delta의 경우 음수 값이 가능하므로 부호 보존 로그 변환 필요
- 20-period MA 정규화 시 0으로 나누기 방지를 위해 `clip(lower=1e-10)` 적용

### Follow-up
- 실제 학습 후 피처 중요도 분석 필요
- Volume delta가 예측 성능에 기여하는지 확인 필요

### Completed
2025-12-19

